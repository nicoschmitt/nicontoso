"use strict";"undefined"!=typeof module&&module.exports&&(module.exports.inject=function(e){return new AuthenticationContext(e)}),function(){if(angular){var e=angular.module("AdalAngular",[]);e.provider("adalAuthenticationService",function(){var e=null,t={isAuthenticated:!1,userName:"",loginError:"",profile:""},n=function(n){n===e.config.clientId&&(n=[e.config.clientId]),e._validateInputScope(n);var o=e.getCachedToken(n);t.isAuthenticated=null!==o&&o.length>0;var r=e.getCachedUser()||{userName:""};t.userName=r.userName,t.profile=r.profile,t.loginError=e.getLoginError()};this.init=function(t,o){if(!t)throw new Error("You must set configOptions, when calling init");var r=window.location.hash,i=window.location.href;r&&(i=i.replace(r,"")),t.redirectUri=t.redirectUri||i,t.postLogoutRedirectUri=t.postLogoutRedirectUri||i,o&&o.interceptors&&o.interceptors.push("ProtectedResourceInterceptor"),e=new AuthenticationContext(t),n(e.config.clientId)},this.$get=["$rootScope","$window","$q","$location","$timeout",function(o,r,i,a,c){function l(e,t){return t.requireADLogin?e.requireADLogin!==!1:!!e.requireADLogin}var u=function(){var i=r.location.hash;if(e.isCallback(i)){var l=e.getRequestInfo(i);if(e.saveTokenFromHash(l),a.$$html5?r.location=r.location.origin+r.location.pathname:r.location.hash="",l.requestType!==e.REQUEST_TYPE.LOGIN&&(e.callback=r.parent.AuthenticationContext().callback,l.requestType===e.REQUEST_TYPE.RENEW_TOKEN&&(e.callback=r.parent.callBackMappedToRenewStates[l.stateResponse])),l.stateMatch)if("function"==typeof e.callback){if(l.requestType===e.REQUEST_TYPE.RENEW_TOKEN){if(l.parameters.access_token)return void e.callback(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),l.parameters.access_token);if(l.parameters.id_token)return void e.callback(e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION),l.parameters.id_token)}}else n(e.config.clientId),t.userName?(c(function(){n(e.config.clientId),o.userInfo=t;var r=e._getItem(e.CONSTANTS.STORAGE.START_PAGE);r&&a.path(r)},1),o.$broadcast("adal:loginSuccess")):o.$broadcast("adal:loginFailure",e._getItem(e.CONSTANTS.STORAGE.ERROR_DESCRIPTION))}else e.log(e.config.clientId,"No callback. App resumes after closing or moving to new page."),n(e.config.clientId),e._renewActive||t.isAuthenticated||!t.userName||e._getItem(e.CONSTANTS.STORAGE.FAILED_RENEW)||e.acquireTokenSilent(e.config.clientId,null,function(e,n){e?o.$broadcast("adal:loginFailure","auto renew failure"):n&&(t.isAuthenticated=!0)});c(function(){n(e.config.clientId),o.userInfo=t},1)},s=function(){e._logstatus("Login event for:"+a.$$path),e.config&&e.config.localLoginUrl?a.path(e.config.localLoginUrl):(e._saveItem(e.CONSTANTS.STORAGE.START_PAGE,a.$$path),e._logstatus("Start login at:"+window.location.href),o.$broadcast("adal:loginRedirect"),e.login(null))},g=function(n,o){o&&o.$$route&&l(o.$$route,e.config)&&(t.isAuthenticated||(e._logstatus("Route change event for:"+a.$$path),s()))},f=function(n,o){o&&l(o,e.config)&&(t.isAuthenticated||(e._logstatus("State change event for:"+a.$$path),s()))};return o.$on("$routeChangeStart",g),o.$on("$stateChangeStart",f),o.$on("$locationChangeStart",u),n(e.config.clientId),o.userInfo=t,{config:e.config,login:function(t){e.login(t)},loginInProgress:function(){return e.loginInProgress()},logOut:function(){e.logOut()},getCachedToken:function(t){return e.getCachedToken(t)},userInfo:t,acquireTokenSilent:function(t){var n=i.defer();return e.acquireTokenSilent(t,function(t,o){t?(e._logstatus("err :"+t),n.reject(t)):n.resolve(o)}),n.promise},getUser:function(){var t=i.defer();return e.getUser(function(n,o){n?(e._logstatus("err :"+n),t.reject(n)):t.resolve(o)}),t.promise},getScopesForEndpoint:function(t){return e.getScopesForEndpoint(t)},clearCache:function(){e.clearCache()},clearCacheForStoredEntry:function(t){e.clearCacheForStoredEntry(t)},log:function(t,n){e.log(t,n)}}}]}),e.factory("ProtectedResourceInterceptor",["adalAuthenticationService","$q","$rootScope",function(e,t,n){return{request:function(n){if(n){n.headers=n.headers||{};var o=e.getScopesForEndpoint(n.url),r=e.getCachedToken(o),i=!1;if(r)return e.log(o,"Token is avaliable for this url "+n.url),n.headers.Authorization="Bearer "+r,n;if(e.config)for(var a in e.config.endpoints)n.url.indexOf(a)>-1&&(i=!0);if(e.loginInProgress())return e.log(o,"login already start."),t.reject();if(e.config&&i){var c=t.defer();return e.acquireTokenSilent(o).then(function(t){e.log(o,"Token is avaliable"),n.headers.Authorization="Bearer "+t,c.resolve(n)},function(e){c.reject(e)}),c.promise}return n}},responseError:function(o){if(e.log(null,"Getting error in the response"),o&&401===o.status){var r=e.getScopesForEndpoint(o.config.url);e.clearCacheForStoredEntry(r),n.$broadcast("adal:notAuthorized",o,r)}return t.reject(o)}}}])}else console.error("Angular.JS is not included")}();