"use strict";var Logging={log:function(){}},AuthenticationContext;"undefined"!=typeof module&&module.exports&&(module.exports.inject=function(t){return new AuthenticationContext(t)}),AuthenticationContext=function(t){if(this.REQUEST_TYPE={LOGIN:"LOGIN",RENEW_TOKEN:"RENEW_TOKEN",ID_TOKEN:"ID_TOKEN",UNKNOWN:"UNKNOWN"},this.CONSTANTS={ACCESS_TOKEN:"access_token",EXPIRES_IN:"expires_in",ID_TOKEN:"id_token",ERROR_DESCRIPTION:"error_description",SESSION_STATE:"session_state",SCOPE:"scope",STORAGE:{TOKEN_KEYS:"adal.token.keys",ACCESS_TOKEN_KEY:"adal.access.token.key",EXPIRATION_KEY:"adal.expiration.key",START_PAGE:"adal.start.page",FAILED_RENEW:"adal.failed.renew",STATE_LOGIN:"adal.state.login",STATE_RENEW:"adal.state.renew",STATE_RENEW_RESOURCE:"adal.state.renew.resource",STATE_IDTOKEN:"adal.state.idtoken",NONCE_IDTOKEN:"adal.nonce.idtoken",SESSION_STATE:"adal.session.state",USERNAME:"adal.username",IDTOKEN:"adal.idtoken",ERROR:"adal.error",ERROR_DESCRIPTION:"adal.error.description",LOGIN_REQUEST:"adal.login.request",LOGIN_ERROR:"adal.login.error",POLICY:"adal.token.policy"},PARAMETERS:{CLIENT_ID:"client_id",USERNAME:"username",SCOPE:"scope",AUTHORITY:"authority",POLICY:"policy",RESPONSE_TYPE:"response_type",EXPIRE:"expire",TOKEN:"token"},SCOPE_DELIMETER:" ",RESOURCE_DELIMETER:"|",ERR_MESSAGES:{NO_TOKEN:"User is not authorized"},MSA_TENANTID:"9188040d-6c67-4c5b-b112-36a304b66dad"},AuthenticationContext.prototype._singletonInstance)return AuthenticationContext.prototype._singletonInstance;if(AuthenticationContext.prototype._singletonInstance=this,this.instance="https://login.microsoftonline.com/",this.config={},this.callback=null,this.popUp=!1,this._user=null,this._renewActive=!1,this._loginInProgress=!1,this._renewStates=[],window.callBackMappedToRenewStates={},window.policy=null,t.displayCall&&"function"!=typeof t.displayCall)throw new Error("displayCall is not a function");if(!t.clientId)throw new Error("clientId is required");t.scope&&"undefined"!==t.scope||(t.scope=[]),t.correlationId||(t.correlationId=this._guid()),this.config=this._cloneConfig(t),this.config.redirectUri||(this.config.redirectUri=window.location.href),this._validateInputScope(this.config.scope)},AuthenticationContext.prototype.login=function(t){var e=[];this._isEmpty(t)?e=this.config.scope:(e=this.config.scopes.concat(t),this._validateInputScope(e));var i=this._guid();this.config.state=i,this._idTokenNonce=this._guid(),this._logstatus("Expected state: "+i+" startPage:"+window.location),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,window.location),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,i),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce),this._saveItem(this.CONSTANTS.STORAGE.FAILED_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var n=this._getNavigateUrl("id_token",e)+"&nonce="+encodeURIComponent(this._idTokenNonce);this.frameCallInProgress=!1,this._loginInProgress=!0,this.config.displayCall?this.config.displayCall(n):this.promptUser(n)},AuthenticationContext.prototype.loginInProgress=function(){return this._loginInProgress},AuthenticationContext.prototype._hasEntry=function(t){var e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);return e&&!this._isEmpty(e)&&JSON.parse(e).indexOf(t)>-1},AuthenticationContext.prototype._getPotentialEntries=function(t){var e=[],i=JSON.parse(t),n=JSON.parse(this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS));if(this._isEmpty(n))return e;for(var s=0;s<n.length;++s){var o=JSON.parse(n[s]);this._contains(i,o)&&e.push(o)}return e},AuthenticationContext.prototype._contains=function(t,e){for(var i in t)if(t.hasOwnProperty(i)&&(!e.hasOwnProperty(i)||e[i]!==t[i]))return!1;return!0},AuthenticationContext.prototype.getCachedToken=function(t){this._validateInputScope(t);var e,i=[];if(this._isEmpty(t)||t.indexOf(this.config.clientId)>-1)e=this._createTokenCacheEntryKeyForIDToken(),i=this._getPotentialEntries(e);else{e=this._createTokenCacheEntryKey();for(var n=this._getPotentialEntries(e),s=0;s<n.length;++s){var o=JSON.parse(this._getItem(JSON.stringify(n[s])));o&&o.hasOwnProperty(this.CONSTANTS.PARAMETERS.SCOPE)&&this._scopeContains(o[this.CONSTANTS.PARAMETERS.SCOPE],t)&&i.push(n[s])}}if(0===i.length)return null;if(i.length>1)throw Logging.log("scopes: "+t),new Error("Multiple entries found!");var r=JSON.stringify(i[0]),a=JSON.parse(this._getItem(r));if(a){var h=a[this.CONSTANTS.PARAMETERS.TOKEN],T=a[this.CONSTANTS.PARAMETERS.EXPIRE],c=this.config.expireOffsetSeconds||120;return T&&T>this._now()+c?h:(this._saveItem(r,JSON.stringify({})),null)}return null},AuthenticationContext.prototype.getCachedUser=function(){if(this._user)return this._user;var t=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);return this._user=this._createUser(t),this._user},AuthenticationContext.prototype._renewToken=function(t,e){var i=this._parseScope(t);if(this._logstatus("renewToken is called for scopes: "+this._parseScope(t)),!this._hasEntry(this._createTokenCacheEntryKey())){var n=JSON.parse(this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS))||[];n.push(this._createTokenCacheEntryKey()),this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,JSON.stringify(n))}var s=this._addAdalFrame("adalRenewFrame"+i),o=this._guid()+"|"+i;this._idTokenNonce=this._guid(),this.config.state=o,this._renewStates.push(o),this._saveItem(this.CONSTANTS.STORAGE.FAILED_RENEW,""),this._logstatus("Renew token Expected state: "+o);var r=this._getNavigateUrl("token",t)+"&prompt=none&login_hint="+encodeURIComponent(this._user.userName);r+="&domain_hint="+encodeURIComponent(this._user.domainHint),r+="&nonce="+encodeURIComponent(this._idTokenNonce),this.callback=e,window.callBackMappedToRenewStates[o]=e,this.idTokenNonce=null,this._logstatus("Navigate to:"+r),this.log(i,"Navigate to:"+r),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),s.src="about:blank",this._loadFrame(r,"adalRenewFrame"+i)},AuthenticationContext.prototype._renewIdToken=function(t,e){if(this._logstatus("renewIdToken is called"),!this._hasEntry(this._createTokenCacheEntryKeyForIDToken())){var i=JSON.parse(this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS))||[];i.push(this._createTokenCacheEntryKeyForIDToken()),this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,JSON.stringify(i))}var n=this._addAdalFrame("adalIdTokenFrame"),s=this._guid()+"|"+this.config.clientId;this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce),this.config.state=s,this._renewStates.push(s),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,s),this._saveItem(this.CONSTANTS.STORAGE.FAILED_RENEW,""),this._logstatus("Renew token Expected state: "+s);var o=this._getNavigateUrl("id_token",t)+"&prompt=none&login_hint="+encodeURIComponent(this._user.userName);o+="&domain_hint="+encodeURIComponent(this._user.domainHint),o+="&nonce="+encodeURIComponent(this._idTokenNonce),this.callback=e,this.idTokenNonce=null,this._logstatus("Navigate to:"+o),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),n.src="about:blank",this._loadFrame(o,"adalIdTokenFrame")},AuthenticationContext.prototype._loadFrame=function(t,e){var i=this;i._logstatus("LoadFrame: "+e);var n=e;setTimeout(function(){var e=i._addAdalFrame(n);""!==e.src&&"about:blank"!==e.src||(e.src=t,i._loadFrame(t,n))},500)},AuthenticationContext.prototype.acquireTokenSilent=function(t,e){t=t||this.config.scope,this._validateInputScope(t);var i;try{i=this.getCachedToken(t)}catch(n){e(n,null)}return i?(this._logstatus("Token in cache"),void e(null,i)):this._getItem(this.CONSTANTS.STORAGE.FAILED_RENEW)?(this._logstatus("renewToken is failed:"+this._getItem(this.CONSTANTS.STORAGE.FAILED_RENEW)),void e(this._getItem(this.CONSTANTS.STORAGE.FAILED_RENEW),null)):this._user?(this._renewActive=!0,void(this._isEmpty(t)||t.indexOf(this.config.clientId)>-1?(this._logstatus("renewing idtoken"),this._renewIdToken(t,e)):(this._logstatus("renewing accesstoken"),this._renewToken(t,e)))):void e("User login is required",null)},AuthenticationContext.prototype.promptUser=function(t){t?(this._logstatus("Navigate to:"+t),window.location.replace(t)):this._logstatus("Navigate url is empty")},AuthenticationContext.prototype.clearCache=function(){this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY,0),this._saveItem(this.CONSTANTS.STORAGE.FAILED_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._renewStates=[],this._saveItem(this.CONSTANTS.STORAGE.STATE_IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.START_PAGE,""),this._saveItem(this.CONSTANTS.STORAGE.USERNAME,""),this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS),e=t?JSON.parse(t):{};if(!this._isEmpty(e))for(var i=0;i<e.length;i++)this._saveItem(e[i],JSON.stringify({}));this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,JSON.stringify([]))},AuthenticationContext.prototype.clearCacheForStoredEntry=function(t){this._saveItem(this.CONSTANTS.STORAGE.FAILED_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var e;e=t===this.config.clientId||t&&t.indexOf(this.config.clientId)>-1?this._createTokenCacheEntryKeyForIDToken():this._createTokenCacheEntryKey();for(var i=this._getPotentialEntries(e),n=0;n<i.length;n++)this._saveItem(JSON.stringify(i[n]),JSON.stringify({}))},AuthenticationContext.prototype.logOut=function(){this.clearCache();var t="common",e="";this._user=null,this.config.tenant&&(t=this.config.tenant),this.config.instance&&(this.instance=this.config.instance),this.config.postLogoutRedirectUri&&(e="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri));var i=this.instance+t+"/oauth2/logout?"+e;this._logstatus("Logout navigate to: "+i),this.promptUser(i)},AuthenticationContext.prototype._isEmpty=function(t){return"undefined"==typeof t||!t||0===t.length},AuthenticationContext.prototype.getUser=function(t){if("function"!=typeof t)throw new Error("callback is not a function");if(this.callback=t,this._user)return void this.callback(null,this._user);var e=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);this._isEmpty(e)?this.callback("User information is not available"):(this._logstatus("User exists in cache: "),this._user=this._createUser(e),this.callback(null,this._user))},AuthenticationContext.prototype._createUser=function(t){var e=null,i=this._extractIdToken(t);return i&&i.hasOwnProperty("aud")&&(i.aud.toLowerCase()===this.config.clientId.toLowerCase()?(e={userName:"",domainHint:"",profile:i},i.hasOwnProperty("preferred_username")&&(e.userName=i.preferred_username),i.hasOwnProperty("tid")&&(i.tid===this.CONSTANTS.MSA_TENANTID?e.domainHint="consumers":e.domainHint="organizations")):this._logstatus("IdToken has invalid aud field")),e},AuthenticationContext.prototype._getHash=function(t){return t.indexOf("#/")>-1?t=t.substring(t.indexOf("#/")+2):t.indexOf("#")>-1&&(t=t.substring(1)),t},AuthenticationContext.prototype.isCallback=function(t){t=this._getHash(t);var e=this._deserialize(t);return e.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||e.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||e.hasOwnProperty(this.CONSTANTS.ID_TOKEN)},AuthenticationContext.prototype.getLoginError=function(){return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR)},AuthenticationContext.prototype.getRequestInfo=function(t){t=this._getHash(t);var e=this._deserialize(t),i={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:this.REQUEST_TYPE.UNKNOWN};if(e&&(i.parameters=e,e.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||e.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||e.hasOwnProperty(this.CONSTANTS.ID_TOKEN))){i.valid=!0;var n="";switch(e.hasOwnProperty("state")?(this._logstatus("State: "+e.state),n=e.state):this._logstatus("No state returned"),i.stateResponse=n,n){case this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN):i.requestType=this.REQUEST_TYPE.LOGIN,i.stateMatch=!0;break;case this._getItem(this.CONSTANTS.STORAGE.STATE_IDTOKEN):i.requestType=this.REQUEST_TYPE.ID_TOKEN,this._saveItem(this.CONSTANTS.STORAGE.STATE_IDTOKEN,""),i.stateMatch=!0}if(!i.stateMatch&&window.parent&&window.parent.AuthenticationContext())for(var s=window.parent.AuthenticationContext()._renewStates,o=0;o<s.length;o++)if(s[o]===i.stateResponse){i.requestType=this.REQUEST_TYPE.RENEW_TOKEN,i.stateMatch=!0;break}}return i},AuthenticationContext.prototype._getScopesFromState=function(t){if(t){var e=t.indexOf("|");if(e>-1&&e+1<t.length)return t.substring(e+1)}return""},AuthenticationContext.prototype.saveTokenFromHash=function(t){if(this._logstatus("State status:"+t.stateMatch),this._logstatus("Request type"+t.requestType),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),t.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION))this._logstatus("Error :"+t.parameters.error),this._logstatus("Error description:"+t.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.STORAGE.FAILED_RENEW,t.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.STORAGE.ERROR,t.parameters.error),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,t.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),t.requestType===this.REQUEST_TYPE.LOGIN?(this._loginInProgress=!1,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,t.parameters.errorDescription)):this._renewActive=!1;else if(t.stateMatch){if(this._logstatus("State is right"),t.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)&&this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,t.parameters[this.CONSTANTS.SESSION_STATE]),t.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)){this._logstatus("Fragment has access token"),this._renewActive=!1;var e=this._createTokenCacheEntryKey(),i=this._createTokenCacheEntryValue(t);this._saveTokenIntoCache(e,i)}if(t.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)&&(this._loginInProgress=!1,this._user=this._createUser(t.parameters[this.CONSTANTS.ID_TOKEN]),this._user&&this._user.profile))if(this._user.profile.nonce!==this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN))this._user=null,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Nonce is not same as "+this._idTokenNonce);else{this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,t.parameters[this.CONSTANTS.ID_TOKEN]);var e=this._createTokenCacheEntryKeyForIDToken(),i=this._createTokenCacheEntryValue(t);this._saveTokenIntoCache(e,i)}}else this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Invalid_state"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid_state"),t.requestType===this.REQUEST_TYPE.LOGIN&&this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"State is not same as "+t.stateResponse)},AuthenticationContext.prototype._saveTokenIntoCache=function(t,e){if(!this._hasEntry(t)){var i=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)?JSON.parse(this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)):[];i.push(t),this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,JSON.stringify(i))}this._saveItem(t,e)},AuthenticationContext.prototype.getScopesForEndpoint=function(t){if(this.config&&this.config.endpoints)for(var e in this.config.endpoints)if(t.indexOf(e)>-1){var i=this.config.endpoints[e];if(i&&i.hasOwnProperty("scope"))return i.scope}return[this.config.clientId]},AuthenticationContext.prototype.handleWindowCallback=function(){var t=window.location.hash;if(this.isCallback(t)){var e=this.getRequestInfo(t);this.log(this._getScopesFromState(e.stateResponse),"returned from redirect url"),this.saveTokenFromHash(e);var i=null;if(e.requestType!==this.REQUEST_TYPE.RENEW_TOKEN&&e.requestType!==this.REQUEST_TYPE.ID_TOKEN||!window.parent?window&&window.oauth2Callback&&(this._logstatus("Window is redirecting"),i=this.callback):(this._logstatus("Window is in iframe"),i=window.parent.callBackMappedToRenewStates[e.stateResponse],window.src=""),window.location.hash="",window.location=this._getItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST),e.requestType===this.REQUEST_TYPE.RENEW_TOKEN)return void i(this._getItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION),e.parameters[this.CONSTANTS.ACCESS_TOKEN]||e.parameters[this.CONSTANTS.ID_TOKEN]);if(e.requestType===this.REQUEST_TYPE.ID_TOKEN)return void i(this._getItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION),this._createUser(this._getItem(this.CONSTANTS.STORAGE.IDTOKEN)))}},AuthenticationContext.prototype._getNavigateUrl=function(t,e){var i="common";this.config.tenant&&(i=this.config.tenant),this.config.instance&&(this.instance=this.config.instance),"id_token"===t&&(e.indexOf(this.config.clientId)>-1?this._translateClientIdUsedInScope(e):-1===e.indexOf("openid")&&e.push("openid"));var n=this.instance+i+"/oauth2/v2.0/authorize"+this._serialize(t,this.config,e)+this._addClientId();return this._logstatus("Navigate url:"+n),n},AuthenticationContext.prototype._extractIdToken=function(t){var e=this._decodeJwt(t);if(!e)return null;try{var i=e.JWSPayload,n=this._base64DecodeStringUrlSafe(i);return n?JSON.parse(n):(this._logstatus("The returned id_token could not be base64 url safe decoded."),null)}catch(s){this._logstatus("The returned id_token could not be decoded: "+s.stack)}return null},AuthenticationContext.prototype._extractUserName=function(t){try{var e=this._extractIdToken(t);if(e){if(e.hasOwnProperty("upn"))return e.upn;if(e.hasOwnProperty("email"))return e.email}}catch(i){this._logstatus("The returned id_token could not be decoded: "+i.stack)}return null},AuthenticationContext.prototype._base64DecodeStringUrlSafe=function(t){return t=t.replace(/-/g,"+").replace(/_/g,"/"),window.atob?decodeURIComponent(escape(window.atob(t))):(this._logstatus("Browser is not supported"),null)},AuthenticationContext.prototype._decodeJwt=function(t){var e=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/,i=e.exec(t);if(!i||i.length<4)return this._logstatus("The returned id_token is not parseable."),null;var n={header:i[1],JWSPayload:i[2],JWSSig:i[3]};return n},AuthenticationContext.prototype._convertUrlSafeToRegularBase64EncodedString=function(t){return t.replace("-","+").replace("_","/")},AuthenticationContext.prototype._serialize=function(t,e,i){var n=[];return null!==e&&(n.push("?response_type="+t),n.push("client_id="+encodeURIComponent(e.clientId)),n.push("scope="+encodeURIComponent(this._parseScope(i))),n.push("redirect_uri="+encodeURIComponent(e.redirectUri)),n.push("state="+encodeURIComponent(e.state)),e.hasOwnProperty("extraQueryParameter")&&n.push(e.extraQueryParameter),e.correlationId&&n.push("client-request-id="+encodeURIComponent(e.correlationId))),n.join("&")},AuthenticationContext.prototype._deserialize=function(t){var e,i=/\+/g,n=/([^&=]+)=?([^&]*)/g,s=function(t){return decodeURIComponent(t.replace(i," "))},o={};for(e=n.exec(t);e;)o[s(e[1])]=s(e[2]),e=n.exec(t);return o},AuthenticationContext.prototype._guid=function(){for(var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",e="0123456789abcdef",i=0,n="",s=0;36>s;s++)"-"!==t[s]&&"4"!==t[s]&&(i=16*Math.random()|0),"x"===t[s]?n+=e[i]:"y"===t[s]?(i&=3,i|=8,n+=e[i]):n+=t[s];return n},AuthenticationContext.prototype._expiresIn=function(t){return this._now()+parseInt(t,10)},AuthenticationContext.prototype._now=function(){return Math.round((new Date).getTime()/1e3)},AuthenticationContext.prototype._addAdalFrame=function(t){if("undefined"!=typeof t){this._logstatus("Add adal frame to document:"+t);var e=document.getElementById(t);if(!e){if(document.createElement&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))){var i=document.createElement("iframe");i.setAttribute("id",t),i.style.visibility="hidden",i.style.position="absolute",i.style.width=i.style.height=i.borderWidth="0px",e=document.getElementsByTagName("body")[0].appendChild(i)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+t+'" id="'+t+'" style="display:none"></iframe>');window.frames&&window.frames[t]&&(e=window.frames[t])}return e}},AuthenticationContext.prototype._logstatus=function(t){console&&console.log(t)},AuthenticationContext.prototype._saveItem=function(t,e){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?(localStorage.setItem(t,e),!0):(this._logStatus("Local storage is not supported"),!1):this._supportsSessionStorage()?(sessionStorage.setItem(t,e),!0):(this._logstatus("Session storage is not supported"),!1)},AuthenticationContext.prototype._getItem=function(t){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?localStorage.getItem(t):(this._logstatus("Local storage is not supported"),null):this._supportsSessionStorage()?sessionStorage.getItem(t):(this._logstatus("Session storage is not supported"),null)},AuthenticationContext.prototype._supportsLocalStorage=function(){try{return"localStorage"in window&&window.localStorage}catch(t){return!1}},AuthenticationContext.prototype._supportsSessionStorage=function(){try{return"sessionStorage"in window&&window.sessionStorage}catch(t){return!1}},AuthenticationContext.prototype._cloneConfig=function(t){if(null===t||"object"!=typeof t)return t;var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},AuthenticationContext.prototype._libVersion=function(){return"2.0.0-experimental"},AuthenticationContext.prototype._addClientId=function(){return"&x-client-SKU=Js&x-client-Ver="+this._libVersion()},AuthenticationContext.prototype.log=function(t,e){var i=this.config.correlationId,n=(new Date).toUTCString(),s=n+":"+i+": ";t&&(s+=Array.isArray(t)?this._parseScope(t)+":":t+":"),s+=e+";",Logging.log(s)},AuthenticationContext.prototype._parseScope=function(t){var e="";if(t)for(var i=0;i<t.length;++i)e+=i!==t.length-1?t[i]+" ":t[i];return e},AuthenticationContext.prototype._scopeContains=function(t,e){if(!t||this._isEmpty(t))return!1;if(e.indexOf(this.config.clientId)>-1)return!0;for(var i=0;i<e.length;i++)if(-1===t.indexOf(e[i].toLowerCase()))return!1;return!0},AuthenticationContext.prototype._createTokenCacheEntryKey=function(){var t={};return this.config.clientId&&(t[this.CONSTANTS.PARAMETERS.CLIENT_ID]=this.config.clientId),t[this.CONSTANTS.PARAMETERS.AUTHORITY]=this.instance,this._user=this.getCachedUser(),this._user&&this._user.userName&&(t[this.CONSTANTS.PARAMETERS.USERNAME]=this._user.userName),JSON.stringify(t)},AuthenticationContext.prototype._createTokenCacheEntryKeyForIDToken=function(){var t={};return t[this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY]=this.config.clientId,JSON.stringify(t)},AuthenticationContext.prototype._createTokenCacheEntryValue=function(t){var e={};return t.parameters.hasOwnProperty(this.CONSTANTS.PARAMETERS.SCOPE)&&(e[this.CONSTANTS.PARAMETERS.SCOPE]=t.parameters[this.CONSTANTS.PARAMETERS.SCOPE].toLowerCase()),t.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)?(e[this.CONSTANTS.PARAMETERS.TOKEN]=t.parameters[this.CONSTANTS.ID_TOKEN],e[this.CONSTANTS.PARAMETERS.EXPIRE]=this._user.profile.exp):t.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)&&(e[this.CONSTANTS.PARAMETERS.TOKEN]=t.parameters[this.CONSTANTS.ACCESS_TOKEN],t.parameters.hasOwnProperty(this.CONSTANTS.EXPIRES_IN)&&(e[this.CONSTANTS.PARAMETERS.EXPIRE]=this._expiresIn(t.parameters[this.CONSTANTS.EXPIRES_IN]))),JSON.stringify(e)},AuthenticationContext.prototype._translateClientIdUsedInScope=function(t){var e=t.indexOf(this.config.clientId);e>=0&&(t.splice(e,1),t.push("openid"))},AuthenticationContext.prototype._validateInputScope=function(t){if(t&&!this._isEmpty(t)){if(!Array.isArray(t))throw new Error("API does not accept non-array scopes");if(t.indexOf("openid")>-1)throw new Error("API does not accept openid as a user-provided scope");if(t.indexOf("offline_access")>-1)throw new Error("API does not accept offline_access as a user-provided scope");if(t.indexOf(this.config.clientId)>-1&&t.length>1)throw new Error("Client Id can only be provided as a single scope")}};